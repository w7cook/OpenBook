#{extends 'two_panel.html' /}
<link rel="stylesheet" type="text/css" media="screen"
      href="@{'/public/stylesheets/event.css'}" />
<script type="text/javascript"
        src="//maps.googleapis.com/maps/api/js?sensor=false&libraries=place">
</script>
<script type="text/javascript"
        src="/public/javascripts/event.js"> 
</script>

<div id="contentArea-BigPage">  
  <h2>Event - ${name}</h2>
  <hr />
    
  <table>
    <tr>
      <td id="details" width = "100%">
        <b>Event Name: </b> ${name}<br /> 
        ${privacy} <br /> 
        <b>Created By: </b>${myAuthor}<br />
        <b>Date: </b>${myDate}<br /> 
        <b>Location: </b>${location}<br /> 
        <b>Details: </b>${description}<br />
      </td>
        
      <td id="map" width = "10%">
        <input id="searchTextField" type="text" size="23%" value="${location}">
        <div id="map_canvas"></div>
      </td>
    </tr>
  </table>
    
  <h4>The Event members:</h4>
  #{list items:e.members, as:'member'}
    <a href="@{Application.about(member.id)}">${member.name}</a>
    <br />
  #{/list}
  <br />
  #{if user.id == currentUser.id}
    #{form @Events.newEventPost(e.id,user.id)}
      <textarea name="post_content" id="postContent" rows="2" cols="45"></textarea>
      <input type="submit" value="Post" />
    #{/form}
  #{/if}
  #{list items:e.getPosts(), as:'item'}
    <div class="post">
      <div class="hideable">
        <div class="left">
          <img src=@{Photos.getPhoto(item.author.profile.profilePhoto)} />
        </div>
          
        <div class="individual-post">
          <span class="post-author">
            <a href="@{Application.news(item.author.id)}">
              ${item.author.name}
            </a>
          </span>
          <div class="post-content tohideopp">
            ${item.contentTeaser().nl2br()}
            <a class='triggershow showfirst' href='#' onclick='return false;'> +more </a>
          </div>https://github.com/ProCynic/OpenBook/blob/api/app/views/Events/event.html
          <div class="tohide hide">
            <div class="post-content">${item.content.nl2br()}</div>
            #{list items:item.getComments(), as:'comment'}
              <div class="comment">
                <div class="comment-metadata">
                  <div class="comment-author">by ${comment.author},</div>
                  <div class="comment-date">
                    ${comment.updatedAt.format('dd MMM yy')}
                  </div>
                  #{if comment.author == currentUser.first_name}
                    <a class="button"  href="@{Comments.deleteComment(comment.id,user.id)}">delete</a>
                  #{/if}
                  #{if comment.currentUserLiked()}
                    <a class="button" href="@{Comments.unLike(comment.id,user.id)}"> Unlike</a>
                  #{/if}
                  #{else}
                    <a class="button" href="@{Comments.addLike(comment.id,user.id)}">Like</a>
                  #{/else}
                  <div>${comment.likes.size()} likes</div>
                </div>
                <div class="comment-content">
                  ${comment.content.escape().nl2br()}
                </div>
              </div>
            #{/list}
            <a class='triggerhide' href='#' onclick='return false;'>
              -less
              <br />
            </a>
          </div>
          
          <div class="individual-post-metadata">
            ${item.likes.size()}
            #{if user.isFriendsWith(currentUser) || user==currentUser}
              #{if item.currentUserLiked()}
                <a href="@{Application.unLike(item.id,user.id)}">Unlike</a>
              #{/if}
              #{else}
                <a href="@{Application.addLike(item.id,user.id)}">Like</a>
              #{/else}
            #{/if}
            . <a href="#" onclick="showDiv('comment ${item.id}')">Comment</a> .
            ${item.updatedAt.format('dd MMM yy')}
            #{if item.author == currentUser}
                . <a href="@{Posts.deletePost(item.id,user.id)}">delete my post</a>
            #{/if}
          
            <div id="comment ${item.id}" class="comment-textarea">
              #{form @Comments.postComment(item.id, user.id, commentContent)}
                <div>
                  <textarea name="commentContent" id="commentContent"></textarea>
                </div>
                <input type="submit" value="Comment"/>
              #{/form}
            </div>
          </div>
        </div>
      </div>
    </div>
  #{/list}
  <a class="button" href="@{Events.events()}"> Events</a>
  <br />
  <br />
</div>
