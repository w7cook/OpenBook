<div id="comment${_comment.id}" class="comments${_comment.id}">
	<div class="comment-metadata">
		<div class="comment-thumb">
			<img style="width: 30px; height: 30px;"	src="@{Photos.getPhoto(_comment.author.profile.profilePhoto)}" />
			<br>
		</div>
		<div class="comment-author">              
      <a href="@{Application.news(_comment.author.id)}">${_comment.author.name}</a>
    </div>
		<div class="comment-date">
		#{if (new Date().getTime() - _comment.updatedAt.getTime())/1000/60 < 1}
        	less than a minute
        #{/if}
        #{elseif (new Date().getTime() - _comment.updatedAt.getTime())/1000/60 < 60}
        	${(int)(new Date().getTime() - _comment.updatedAt.getTime())/1000/60} minutes ago
        #{/elseif}
        #{elseif (new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60 < 24}
        	${(int)(new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60} hours ago
        #{/elseif}
        #{elseif (new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60/24 < 30}
        	${(int)(new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60/24} days ago
        #{/elseif}
        #{elseif (new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60/24/30 < 12}
        	${(int)(new Date().getTime() - _comment.updatedAt.getTime())/1000/60/60/24/30} months ago
        #{/elseif}
        #{else}
        	over a year ago
        #{/else}
		</div>
		<div id="comment${_comment.id}likes">${_comment.likes.size()} like${_comment.likes.size().pluralize()}</div>
		#{if _comment.author.id == _currentUser.id} 
		<a class=button id="deleteCommentSubmit${_comment.id}" href="#" onclick="return false;">delete</a>
		#{/if} 
		        <a class="button" id="likeButton${_comment.id}" href = '#' onclick="return false;">*{Text here is generated by drawLikesButton_xx}*</a>
	</div>
	<div class="comment-content">
		${_comment.content.escape().nl2br()}</div>
</div>
<script type="text/javascript">
   $('a#deleteCommentSubmit${_comment.id}').click(function(event) {
       var deleteData = {
             id : ${_comment.id},
             userId : ${_user.id},
         };
       
         $.post("/comments/deletecomment", deleteData, function() {
         $('div#comment${_comment.id}').slideUp();
         });
   });
</script>
<script >
var likes_${_comment.id} = ${_comment.currentUserLiked()};

function drawLikesButton_${_comment.id}( elem ) {
  if( !likes_${_comment.id} ) {
    elem.text('Like');
  } else {
    elem.text('Unlike');
  }
}

drawLikesButton_${_comment.id}( $('#likeButton${_comment.id}') );

$('#likeButton${_comment.id}').click(function(){
  var postData = {
     likeableId  : ${_comment.id}, 
  };
  
  var bttn = $(this);

  if( !likes_${_comment.id} ) {
    $.post("/Application/addLikeAjax", postData, function(data) {
      $("div#comment${_comment.id}likes").text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
      likes_${_comment.id} = !likes_${_comment.id};
      drawLikesButton_${_comment.id}(bttn);
    });
  } else {
    $.post("/Application/removeLikeAjax", postData, function(data) {
      $("div#comment${_comment.id}likes").text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
      likes_${_comment.id} = !likes_${_comment.id};
      drawLikesButton_${_comment.id}(bttn);
    });
  }

});

</script>