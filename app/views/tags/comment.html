<div id="comment${_comment.id}"
    style="background-color: #e8e8e8; margin-top: 2px; width: 100%;">
	<div class="comment-content">
    <div class="comment-thumb">
      <img style="width: 30px; height: 30px;" src="@{Photos.getPhoto(_comment.author.profile.profilePhoto)}" />
    </div>
    <div class="comment-author">              
      <a href="@{Users.about(_comment.author.id)}">${_comment.author.name}</a>
    </div>
    ${_comment.content.nl2br()}
  </div>
  <div class="comment-metadata">
    <span id="comment${_comment.id}likes">${_comment.likes.size()} like${_comment.likes.size().pluralize()}
    </span> 
    <a class="button" id="likeButton${_comment.id}" href = '#' onclick="return false;">*{Text here is generated by drawLikesButton_xx}*</a>
    <span class="comment-date">
      #{timeago date:_comment.updatedAt /}
    </span>
    #{if _comment.author.id == _currentUser.id} 
    <a class=button id="deleteCommentSubmit${_comment.id}" href="#" onclick="return false;">&{'comment.delete'}</a>
    #{/if} 
  </div>
</div>
<script type="text/javascript">
   $('a#deleteCommentSubmit${_comment.id}').click(function(event) {
       var deleteData = {
             id : ${_comment.id},
             userId : ${_user.id},
         };
       
         $.post("/comments/deletecomment", deleteData, function() {
         $('#comment${_comment.id}').slideUp();
         });
   });
</script>
<script >
var likes_${_comment.id} = ${_comment.currentUserLiked()};

function drawLikesButton_${_comment.id}( elem ) {
  if( !likes_${_comment.id} ) {
    elem.text("&{'comment.like'}");
  } else {
    elem.text("&{'comment.unlike'}");
  }
}

drawLikesButton_${_comment.id}( $('#likeButton${_comment.id}') );

$('#likeButton${_comment.id}').click(function(){
  var postData = {
     likeableId  : ${_comment.id}, 
  };
  
  var bttn = $(this);

  if( !likes_${_comment.id} ) {
    $.post("/Application/addLikeAjax", postData, function(data) {
      $("span#comment${_comment.id}likes").text(data.numLikes+ " " +"&{'comment.like'}"+(data.numLikes == 1? "" : "s"));
      likes_${_comment.id} = !likes_${_comment.id};
      drawLikesButton_${_comment.id}(bttn);
    });
  } else {
    $.post("/Application/removeLikeAjax", postData, function(data) {
      $("span#comment${_comment.id}likes").text(data.numLikes+ " " +"&{'comment.like'}"+(data.numLikes == 1? "" : "s"));
      likes_${_comment.id} = !likes_${_comment.id};
      drawLikesButton_${_comment.id}(bttn);
    });
  }

});

</script>
