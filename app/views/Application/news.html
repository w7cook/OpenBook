#{extends 'main.html' /}
<table>
  <tr>
  <td>
     [Picture]
     ${user.email}
 
    <br>
    <a href="@{Application.news()}">news</a>
    <br>
    <a href="@{Application.about()}">about</a>
    <br>
    <a href="@{Checkin.checkin()}">Checkin</a>
    <br>friends:<br>
     #{list items:user.confirmedFriends(), as:'friendship'}
     <a href="@{Application.news(friendship.to.id)}">${ friendship.to.name }</a><br>
     #{/list}
  </td>
  <td>
     <h1>${user.name}</h1> 
     #{if user.checkFriendship(user.id) == 'Request Friendship'}
         <a id="friend-button" href="@{Application.requestFriends(user.id)}">
            ${user.checkFriendship(user.id)}
             </a>
     #{/if}
     #{elseif user.checkFriendship(user.id) == 'Friendship Requested'}
        Friendship Requested
     #{/elseif}
     #{elseif user.checkFriendship(user.id) == 'Friends'}
        Friends :) 
        <a id="friend-button" href="@{Application.removeFriends(user.id)}">
            Remove friend
        </a>
    #{/elseif}
	
	#{if user.id == currentUser.id}
	   #{form @Posts.newPost(user.id)}
            <textarea name="post_content" id="post_content"></textarea>
            <input type="submit" value="Post" />
       #{/form}
    #{/if}
     <h3>Blog Posts</h3>
     #{list items:user.news(), as:'item'}
        <div class="post">
        <span class="post-author"><a href="@{Application.news(item.author.id)}">${ item.author.name }</a></span>,
        <span class="post-date">${item.date.format('dd MMM yy')}</span>
        #{if item.author == currentUser}
            <a class=button href="@{Posts.deletePost(item.id,user.id)}">delete post</a>
        #{/if}
        <div class="post-content">

            ${item.content.nl2br()}
          </div>
          #{list items:item.comments(), as:'comment'}
            <div class="comment">
                <div class="comment-metadata">
                    <span class="comment-author">by ${comment.author},</span>
                    <span class="comment-date">
                        ${comment.date.format('dd MMM yy')}
                    #{if comment.author == currentUser.first_name}
                        <a class=button href="@{Comments.deleteComment(comment.id,user.id)}">delete</a>
                    #{/if}
                    </span>
                </div>
                <div class="comment-content">
                    ${comment.content.escape().nl2br()}
                </div>
            </div>
        #{/list} 
        #{if user.isFriendsWith(currentUser) || user==currentUser}
        
            <input type="button" value="new comment" onclick="showDiv('comment ${item.id}')" />
		     
		    <div id="comment ${item.id}" style="display:none;border-width:1px;border-color:black;border-style:solid;margin:0px 20px 0px 20px;">
            #{form @Comments.postComment(item.id, user.id)}
        	   <textarea name="content" id="content"></textarea>
        	   <input type="submit" value="Comment" />
        	   <input type="button" value="cancel" onclick="hideDiv('comment ${item.id}')" />
		    #{/form}	    
		    </div>
		 #{/if}
		
	   
    </div>
    #{/list}
  </td>
  </tr>
</table>
